"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[128],{8128:(e,n,t)=>{t.r(n),t.d(n,{ForgeInspector:()=>C,debugFiberSource:()=>T,deepSearchForSource:()=>x});var o=t(2503),r=t(4669),c=t(5617),i=t(2299);function l(e,n){let{columnNumber:t=1,fileName:o,lineNumber:r=1}=e,c="".concat(o,":").concat(r,":").concat(t);return n&&(c=n(c)),c}function s(e){let n=new Set,t=function(e){if("__REACT_DEVTOOLS_GLOBAL_HOOK__"in window){let{renderers:n}=window.__REACT_DEVTOOLS_GLOBAL_HOOK__;for(let t of n.values())try{let n=t.findFiberByHostInstance(e);if(n)return n}catch(e){}}if("_reactRootContainer"in e)return e._reactRootContainer._internalRoot.current.child;for(let n in e)if(n.startsWith("__reactInternalInstance$")||n.startsWith("__reactFiber"))return e[n]}(e);for(;t;)n.add(t),t=t._debugOwner||t.return;return Array.from(n)}let a=window.__FORGE_INSPECTOR_DEBUG__;function u(e){var n,t,o,r,c,i,l,s,u,d,p,g,f,m,w,h,b;if(e._debugSource){let{columnNumber:n=1,fileName:t,lineNumber:o=1}=e._debugSource;return{columnNumber:n,fileName:t,lineNumber:o}}if(e._debugStack){let n=function(e){if(!e)return null;try{let n="string"==typeof e?e:e.stack;if(!n)return null;for(let e of n.split("\n"))if(!(e.includes("react-dom")||e.includes("react_jsx")||e.includes("jsx-runtime")||e.includes("jsx-dev-runtime")||e.includes("node_modules/.vite")||e.includes("react-stack")||e.includes("react_stack")))for(let n of[/at\s+\S+\s+\(([^)]+):(\d+):(\d+)\)/,/at\s+(.+?):(\d+):(\d+)$/,/([^@]+)@(.+?):(\d+):(\d+)$/]){let t=e.match(n);if(t){let e=t[4===t.length?1:2],n=t[4===t.length?2:3],o=t[4===t.length?3:4];if(e.includes("node_modules")&&!e.includes("/src/"))continue;let r=e.replace(/^https?:\/\/[^/]+/,"");if((r=r.split("?")[0].split("#")[0])&&(r.includes(".tsx")||r.includes(".ts")||r.includes(".jsx")||r.includes(".js")))return{fileName:r,lineNumber:parseInt(n,10),columnNumber:parseInt(o,10)}}}}catch(e){a&&console.warn("[ForgeInspector] Failed to parse _debugStack:",e)}return null}(e._debugStack);if(n)return n}let _=(null==(n=e.type)?void 0:n.__source)||(null==(t=e.elementType)?void 0:t.__source)||(null==(o=e.memoizedProps)?void 0:o.__source)||(null==(r=e.pendingProps)?void 0:r.__source)||(null==(i=e._owner)||null==(c=i.memoizedProps)?void 0:c.__source)||(null==(s=e._owner)||null==(l=s.pendingProps)?void 0:l.__source);if(_){let{columnNumber:e=1,fileName:n,lineNumber:t=1}=_;return{columnNumber:e,fileName:n,lineNumber:t}}a&&(console.group("[ForgeInspector] Source not found"),console.log("Fiber instance:",e),console.log("Checked locations:"),console.log("  - instance._debugSource:",e._debugSource),console.log("  - instance._debugStack:",e._debugStack),e._debugStack&&console.log("    Stack preview:","string"==typeof e._debugStack?e._debugStack.split("\n").slice(0,5).join("\n"):null==(b=e._debugStack.stack)?void 0:b.split("\n").slice(0,5).join("\n")),console.log("  - instance.type?.__source:",null==(u=e.type)?void 0:u.__source),console.log("  - instance.elementType?.__source:",null==(d=e.elementType)?void 0:d.__source),console.log("  - instance.memoizedProps?.__source:",null==(p=e.memoizedProps)?void 0:p.__source),console.log("  - instance.pendingProps?.__source:",null==(g=e.pendingProps)?void 0:g.__source),console.log("  - instance._owner?.memoizedProps?.__source:",null==(m=e._owner)||null==(f=m.memoizedProps)?void 0:f.__source),console.log("  - instance._owner?.pendingProps?.__source:",null==(h=e._owner)||null==(w=h.pendingProps)?void 0:w.__source),console.log("Available keys on instance:",Object.keys(e)),console.log("instance.type:",e.type),console.log("instance.elementType:",e.elementType),console.log("instance._owner:",e._owner),console.log("instance.memoizedProps (full):",e.memoizedProps),console.log("instance.pendingProps (full):",e.pendingProps),console.groupEnd())}function d(){let e=(0,o._)(["\n      <button\n        onClick=","\n        aria-pressed=","\n        style=",'\n        title="Select component for AI help"\n      >\n        <img\n          src=','\n          alt="FI Icon"\n          style=',"\n        />\n      </button>\n    "]);return d=function(){return e},e}function p(){let e=(0,o._)(["\n          <span style=","/>\n        "]);return p=function(){return e},e}function g(){let e=(0,o._)(["\n      <button\n        onClick=","\n        disabled=","\n        aria-pressed=","\n        style=","\n        title=","\n      >\n        <img\n          src=","\n          alt=","\n          style=","\n        />\n        ","\n      </button>\n    "]);return g=function(){return e},e}function f(){let e=(0,o._)(["\n        <",'\n          key="click-to-component-record-button"\n          recording=',"\n          status=","\n          disabled=","\n          onToggle=","\n        />\n      "]);return f=function(){return e},e}function m(){let e=(0,o._)(["\n        <",'\n          key="click-to-component-target-button"\n          active=',"\n          onToggle=","\n        />\n      "]);return m=function(){return e},e}function w(){let e=(0,o._)(['\n    <style key="click-to-component-style">\n      [data-click-to-component] * {\n        pointer-events: auto !important;\n      }\n\n      [data-click-to-component-target] {\n        cursor: var(--click-to-component-cursor, crosshair) !important;\n        outline: auto 1px;\n        outline: var(\n          --click-to-component-outline,\n          -webkit-focus-ring-color auto 1px\n        ) !important;\n      }\n\n      @keyframes pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n      }\n\n      [data-recording-active] {\n        outline: 2px solid #dc2626 !important;\n        outline-offset: 2px;\n      }\n    </style>\n\n    <',' key="click-to-component-portal">\n      \x3c!-- Record Button - Only when showButton is true (running from forge) --\x3e\n      ',"\n\n      \x3c!-- Target Button - Only when showButton is true --\x3e\n      ","\n    </",">\n  "]);return w=function(){return e},e}let h=null,b=async()=>(h||(h=await import("./visual-agent/index.js")),h),_={IDLE:"IDLE",HOVER:"HOVER",RECORDING:"RECORDING",PROCESSING:"PROCESSING"},y={ALT_KEY:"alt-key",BUTTON:"button"},v="click-to-component",k=["http://localhost:3000","http://localhost:3001","http://localhost:3333","http://localhost:5173","http://localhost:5174","http://localhost:8080","http://127.0.0.1:3000","http://127.0.0.1:3001","http://127.0.0.1:3333","http://127.0.0.1:5173","http://127.0.0.1:5174","http://127.0.0.1:8080"];function E(){if(document.referrer)try{return new URL(document.referrer).origin}catch(e){console.warn("[ForgeInspector] Invalid referrer URL, falling back to same-origin:",e)}return window.location.origin}function S(e){let{editor:n,pathToSource:t,url:o,trigger:r,event:c,element:i,pathModifier:a,selectedComponent:d}=e;try{var p,g,f,m;let e=i||(c&&c.target instanceof HTMLElement?c.target:null),w=e?e?s(e).filter(e=>u(e)).map(e=>{let n=function(e){let{elementType:n,tag:t}=e;switch(t){case 0:case 1:return n.displayName||n.name||"Anonymous Component";case 3:return"HostRoot";case 4:return"HostPortal";case 5:return n;case 6:return"String";case 7:return"React.Fragment";case 8:return"Mode";case 9:return"Context.Consumer";case 10:return"Context.Provider";case 11:return"React.forwardRef";case 12:return"Profiler";case 13:return"SuspenseComponent";case 14:return"MemoComponent";case 15:var o;return null!=(o=n.type.name)?o:"MemoComponent";case 16:return"React.lazy";case 17:return"IncompleteClassComponent";case 18:return"DehydratedFragment";case 19:return"SuspenseListComponent";case 21:return"ScopeComponent";case 22:return"OffscreenComponent";case 23:return"LegacyHiddenComponent";case 24:return"CacheComponent";case 25:return"TracingMarkerComponent";case 26:return"HostHoistable";case 27:return"HostSingleton";case 28:return"IncompleteFunctionComponent";case 29:return"Throw";default:return console.warn("Unrecognized React Fiber tag: ".concat(t),e),"Unknown Component"}}(e),t=u(e),o=l(t,a);return{name:n,props:function(e){let n={};return Object.entries(e.memoizedProps).forEach(t=>{var o;let[r,c]=t;!["key"].includes(r)&&c!==(null==(o=e.type.defaultProps)?void 0:o[r])&&(["string","number","boolean","symbol"].includes(typeof c)||c instanceof String||c instanceof Number||c instanceof Boolean||c instanceof Symbol)&&(n[r]=c)}),n}(e),source:{fileName:t.fileName,lineNumber:t.lineNumber,columnNumber:t.columnNumber},pathToSource:o}}):[]:[],h=d?w.find(e=>e.name===d):w.find(e=>e.pathToSource===t)||w[0],b=e?{tag:(null==(g=e.tagName)||null==(p=g.toLowerCase)?void 0:p.call(g))||void 0,id:e.id||void 0,className:"string"==typeof e.className?e.className:String(e.className||""),role:e.getAttribute("role")||void 0,dataset:{...e.dataset}}:void 0,_={source:v,version:1,type:"open-in-editor",payload:{selected:h?{editor:n,pathToSource:h.pathToSource,url:o,name:h.name,props:h.props,source:h.source}:{editor:n,pathToSource:t,url:o,name:d||"Unknown",props:{},source:{}},components:w,trigger:r,coords:c?{x:null!=(f=c.clientX)?f:void 0,y:null!=(m=c.clientY)?m:void 0}:void 0,clickedElement:b}};window.parent&&window.parent!==window&&"function"==typeof window.parent.postMessage&&window.parent.postMessage(_,E())}catch(e){console.warn("[click-to-component] postMessage failed",e)}}function C(){if(window.parent===window)return null;let e="vscode",n=e=>e,[t,o]=i.useState(_.IDLE),[a,h]=i.useState(null),[C,x]=i.useState(null),[T,I]=i.useState(!1),[L,R]=i.useState(!1),[O,N]=i.useState("idle"),[P,D]=i.useState(!1),F=i.useRef(null);i.useEffect(()=>{b().then(e=>{let{checkCapabilities:n}=e;D(n().webgpu)}).catch(()=>{D(!1)})},[]);let H='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4" fill="currentColor"/></svg>',M='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><rect x="9" y="9" width="6" height="6" fill="currentColor"/></svg>',j=i.useCallback(e=>{let{active:n,onToggle:t}=e;return(0,c.q)(d(),function(e){e.stopPropagation(),t()},n,{position:"fixed",bottom:"16px",right:"16px",width:"48px",height:"48px",borderRadius:"50%",background:n?"royalblue":"white",color:n?"white":"black",border:"1px solid #ccc",boxShadow:"0 2px 6px rgba(0,0,0,.3)",zIndex:0x7fffffff,cursor:"pointer",fontSize:"18px",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px"},"data:image/svg+xml;utf8,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-square-mouse-pointer-icon lucide-square-mouse-pointer"><path d="M12.034 12.681a.498.498 0 0 1 .647-.647l9 3.5a.5.5 0 0 1-.033.943l-3.444 1.068a1 1 0 0 0-.66.66l-1.067 3.443a.5.5 0 0 1-.943.033z"/><path d="M21 11V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h6"/></svg>'),{width:"32px",height:"32px",filter:n?"brightness(0) invert(1)":"none"})},[]),B=i.useCallback(e=>{let{recording:n,status:t,disabled:o,onToggle:r}=e;return(0,c.q)(g(),function(e){e.stopPropagation(),r()},o,n,{position:"fixed",bottom:"16px",right:"72px",width:"48px",height:"48px",borderRadius:"50%",background:n?"#dc2626":o?"#9ca3af":"white",color:n?"white":o?"#6b7280":"black",border:"1px solid #ccc",boxShadow:"0 2px 6px rgba(0,0,0,.3)",zIndex:0x7fffffff,cursor:o?"not-allowed":"pointer",fontSize:"18px",display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",opacity:o?.6:1},o?"WebGPU required for visual recording":n?"Stop recording":"Start visual recording","data:image/svg+xml;utf8,"+encodeURIComponent(n?M:H),n?"Stop":"Record",{width:"32px",height:"32px",filter:n?"brightness(0) invert(1)":o?"grayscale(1)":"none"},"processing"===t&&(0,c.q)(p(),{position:"absolute",top:"-4px",right:"-4px",width:"12px",height:"12px",borderRadius:"50%",background:"#f59e0b",animation:"pulse 1s infinite"}))},[H,M]),z=i.useCallback(()=>{t===_.HOVER&&a===y.BUTTON?(o(_.IDLE),h(null)):(o(_.HOVER),h(y.BUTTON))},[t,a]),V=i.useCallback((e,n)=>{if(window.parent&&window.parent!==window)try{window.parent.postMessage({source:v,version:1,type:e,payload:n},E())}catch(e){console.warn("[ForgeInspector] postMessage failed:",e)}},[]),U=i.useCallback(async()=>{if(P)if(L){N("processing"),o(_.PROCESSING);try{let e=F.current;if(e){let n=await e.stop();V("qa-report",{report:n,observations:e.observations,sessionDuration:e.sessionDuration}),F.current=null}}catch(e){console.error("[ForgeInspector] Error stopping recording:",e),V("recording-error",{error:"Stop failed: ".concat(e.message)})}R(!1),N("idle"),o(_.IDLE)}else{N("initializing");try{let{eyes:e}=await b(),n=e({onObservation:e=>{V("recording-observation",{observation:e,timestamp:Date.now()})},onStatusChange:e=>{N(e),"recording"===e?o(_.RECORDING):"processing"===e&&o(_.PROCESSING)},onError:e=>{console.error("[ForgeInspector] Visual agent error:",e),V("recording-error",{error:e.message})}});await n.start(),F.current=n,R(!0),V("recording-started",{timestamp:Date.now()})}catch(e){console.error("[ForgeInspector] Error starting recording:",e),V("recording-error",{error:e.message}),N("idle"),o(_.IDLE)}}},[P,L,V]),A=i.useCallback(function(o){t!==_.IDLE&&o.target instanceof HTMLElement&&(o.preventDefault(),S({editor:e,pathToSource:"",url:"",trigger:"context-menu",event:o,element:o.target,pathModifier:n}))},[t,e,n]),G=i.useCallback(function(r){if(t===_.HOVER&&(r.preventDefault(),r.stopPropagation()),t===_.RECORDING&&F.current&&r.target instanceof HTMLElement){let e=r.target,n="clicked ".concat(e.tagName.toLowerCase()).concat(e.id?"#"+e.id:"").concat(e.className?"."+e.className.split(" ")[0]:"");F.current.trigger(n).catch(e=>{console.warn("[ForgeInspector] Trigger observation failed:",e)})}let c=C instanceof HTMLElement?C:r.target instanceof HTMLElement?r.target:null;if(t===_.HOVER&&a===y.BUTTON&&c){S({editor:e,pathToSource:"",url:"",trigger:"context-menu",event:r,element:c,pathModifier:n}),o(_.IDLE),h(null);return}if(t===_.HOVER&&a===y.ALT_KEY&&C instanceof HTMLElement){let t=s(C).find(e=>u(e));if(!t)return console.warn("Could not find React instance for element",C);let c=u(t);if(!c)return console.warn("Could not find source for React instance",t);let i=l(c,n),a=function(e){let{editor:n,pathToSource:t}=e;return"/"===t[0]?"".concat(n,"://file").concat(t):"".concat(n,"://file/").concat(t)}({editor:e,pathToSource:i});r.preventDefault(),S({editor:e,pathToSource:i,url:a,trigger:"alt-click",event:r,element:C,pathModifier:n}),o(_.IDLE),h(null)}},[e,n,t,a,C]),q=i.useCallback(function(e){switch(t){case _.IDLE:e.altKey&&(o(_.HOVER),h(y.ALT_KEY));break;case _.HOVER:"Escape"===e.key&&a===y.BUTTON&&(o(_.IDLE),h(null))}},[t,a]),K=i.useCallback(function(e){t===_.HOVER&&a===y.ALT_KEY&&(o(_.IDLE),h(null))},[t,a]),Y=i.useCallback(function(e){if(e.target instanceof HTMLElement)switch(t){case _.IDLE:case _.HOVER:x(e.target)}},[t]),W=i.useCallback(function(){t===_.HOVER&&(o(_.IDLE),h(null))},[t]);return i.useEffect(function(){for(let e of Array.from(document.querySelectorAll("[data-click-to-component-target]")))e instanceof HTMLElement&&delete e.dataset.clickToComponentTarget;if(t===_.IDLE){delete window.document.body.dataset.clickToComponent,window.document.body.style.removeProperty("--click-to-component-cursor"),C&&delete C.dataset.clickToComponentTarget;return}C instanceof HTMLElement&&(window.document.body.dataset.clickToComponent=t,C.dataset.clickToComponentTarget=t,window.document.body.style.setProperty("--click-to-component-cursor","crosshair"))},[t,C,a]),i.useEffect(function(){function e(e){if(!function(e){if(e.source!==window.parent)return!1;if(document.referrer)try{let n=new URL(document.referrer).origin;return e.origin===n}catch(e){console.debug("[ForgeInspector] Referrer validation failed, using dev origin allowlist:",e)}let n=e.origin;return n===window.location.origin||k.includes(n)}(e))return;let n=null==e?void 0:e.data;if(n&&n.source===v&&1===n.version)switch(console.log("[ForgeInspector] Received message:",n),n.type){case"enable-button":console.log("[ForgeInspector] Enable button message received! Setting showButton=true"),I(!0);break;case"start-selection":console.log("[ForgeInspector] Starting selection mode"),o(_.HOVER),h(y.BUTTON);break;case"stop-selection":console.log("[ForgeInspector] Stopping selection mode"),o(_.IDLE),h(null)}}return window.addEventListener("message",e),()=>window.removeEventListener("message",e)},[]),i.useEffect(()=>()=>{F.current&&(F.current.terminate(),F.current=null)},[]),i.useEffect(function(){if(window.parent&&window.parent!==window&&"function"==typeof window.parent.postMessage)try{window.parent.postMessage({source:v,version:1,type:"ready"},E())}catch(e){console.warn("[ForgeInspector] ready message failed",e)}},[]),i.useEffect(function(){return window.addEventListener("click",G,{capture:!0}),window.addEventListener("contextmenu",A,{capture:!0}),window.addEventListener("keydown",q),window.addEventListener("keyup",K),window.addEventListener("mousemove",Y),window.addEventListener("blur",W),function(){window.removeEventListener("click",G,{capture:!0}),window.removeEventListener("contextmenu",A,{capture:!0}),window.removeEventListener("keydown",q),window.removeEventListener("keyup",K),window.removeEventListener("mousemove",Y),window.removeEventListener("blur",W)}},[G,A,q,K,Y,W]),(0,c.q)(w(),r.XF,T&&(0,c.q)(f(),B,L,O,!P,U),T&&(0,c.q)(m(),j,t===_.HOVER&&a===y.BUTTON,z),r.XF)}function x(e){if(!e)return{found:[],summary:{error:"No fiber node provided"}};let n=function e(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"root",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=[];if(!n||o.has(n)||c>=r||(o.add(n),"object"!=typeof n))return i;try{for(let l in n)try{let s=n[l],a="".concat(t,".").concat(l);if("__source"===l&&s&&"object"==typeof s&&i.push({path:a,value:s,fileName:s.fileName,lineNumber:s.lineNumber,columnNumber:s.columnNumber}),s&&"object"==typeof s){let n=e(s,a,o,r,c+1);i.push(...n)}}catch(e){}try{for(let e of Object.getOwnPropertyNames(n))if("__source"===e)try{let o=n[e];o&&"object"==typeof o&&i.push({path:"".concat(t,".").concat(e),value:o,fileName:o.fileName,lineNumber:o.lineNumber,columnNumber:o.columnNumber})}catch(e){}}catch(e){}}catch(e){}return i}(e,"fiber",new Set,5,0),t={totalFound:n.length,locations:n.map(e=>e.path),fiberTag:e.tag,fiberType:"function"==typeof e.type?e.type.name:e.type,hasDebugSource:!!e._debugSource,hasDebugStack:!!e._debugStack,hasDebugOwner:!!e._debugOwner,hasMemoizedProps:!!e.memoizedProps,hasPendingProps:!!e.pendingProps,hasElementType:!!e.elementType,hasType:!!e.type,hasOwner:!!e._owner,hasReturn:!!e.return};return{found:n,summary:t}}function T(e){console.group("\uD83D\uDD0D Deep Source Search");let n=Object.keys(e||{}).find(e=>e.startsWith("__react"));if(!n)return console.error("No React fiber found on element"),console.groupEnd(),null;let t=e[n];console.log("Found fiber:",t);let o=x(t);console.log("Search result:",o),o.found.length>0?(console.log("✅ __source found at:"),o.found.forEach(e=>{let{path:n,fileName:t,lineNumber:o,columnNumber:r}=e;console.log("  ".concat(n)),console.log("    → ".concat(t,":").concat(o,":").concat(r))})):(console.log("❌ No __source found in fiber node"),console.log("Summary:",o.summary));let r=t.return,c=0;for(console.log("\nChecking parent fibers...");r&&c<10;){let e=x(r);if(e.found.length>0){console.log("✅ __source found in parent ".concat(c,":")),e.found.forEach(e=>{let{path:n,fileName:t,lineNumber:o,columnNumber:r}=e;console.log("  ".concat(n)),console.log("    → ".concat(t,":").concat(o,":").concat(r))});break}r=r.return,c++}return console.groupEnd(),o}window.__debugFiberSource=T,window.__deepSearchForSource=x}}]);